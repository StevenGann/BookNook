# Village – Book Nook Diorama

Narrow Tudor-style alley with window LEDs (oil lamp / fireplace) and LCD “shadow” animations, controllable over WiFi (MQTT / Home Assistant).

## Architecture

- **Pico W**: WiFi, MQTT, SK6812 RGBW LEDs (PIO), I2C master. Sends scene/trigger to each LCD controller.
- **RP2350-Zero** (one per LCD): I2C slave, ST7789V display, bitmap animations from `bitmap_anim.bin`. LCD count is configurable.

See [docs/wiring.md](docs/wiring.md), [docs/i2c_protocol.md](docs/i2c_protocol.md), and [docs/mqtt_topics.md](docs/mqtt_topics.md).

## Folders

| Path | Description |
|------|-------------|
| `firmware/pico_w/` | Pico W MicroPython: config, MQTT, LEDs, I2C master |
| `firmware/rp2350_lcd/` | RP2350-Zero MicroPython: I2C slave, ST7789, animations |
| `tools/` | `image_sequence_to_bitmap.py`: numbered folders 0–254 → `bitmap_anim.bin` (and C), up to 255 scenes |
| `docs/` | Wiring, I2C protocol, MQTT topics |
| `assets/` | Art reference; source images for the tool (e.g. Blender exports) |

## Quick start

1. **Pico W**: Copy `firmware/pico_w/*.py` to the board. Edit `config.py` (WiFi, MQTT, `lcd_i2c_addresses`, LED count). Run `main.py`.
2. **RP2350-Zero**: Copy `firmware/rp2350_lcd/` to each board. Set `I2C_SLAVE_ADDR` in `config.py` per board. Run `main.py`.
3. Run `tools/image_sequence_to_bitmap.py` on a root folder with subfolders 0–254 of images; copy the generated `bitmap_anim.bin` to each RP2350-Zero.
4. Wire I2C (SDA/SCL), LEDs, and LCDs per `docs/wiring.md`. Publish to MQTT topics in `docs/mqtt_topics.md` (scene 0–254).

The RP2350-Zero firmware includes a hardware I2C slave (`i2c_slave_hw.py`) so it receives scene/brightness from the Pico W without external libraries. The Pico W can run without a NeoPixel driver (LEDs no-op) for testing MQTT and I2C.

## Animation model

- **Bitmap-only**: All LCD animations are bitmaps generated by `tools/image_sequence_to_bitmap.py`. The tool reads a root folder with subfolders **0**–**254** (folder N = scene N); each subfolder has 1–120 numbered images (missing folder = 0 frames). Output is `bitmap_anim.bin` (and optional C files). Copy the `.bin` to each RP2350-Zero.
- **Up to 255 scenes** (0–254), **24 fps**, **loop** until another scene is set over I2C (or MQTT via Pico W).
